parts="AT32UC3A0512 AT90CAN128 AT90CAN32 AT90CAN64 AT90PWM2 AT90PWM2B AT90PWM3 AT90PWM316 AT90PWM3B AT90S1200 AT90S2313 AT90S2333 AT90S2343 AT90S4414 AT90S4433 AT90S4434 AT90S8515 AT90S8535 AT90USB1286 AT90USB1287 AT90USB162 AT90USB646 AT90USB647 AT90USB82 ATmega128 ATmega1280 ATmega1281 ATmega1284P ATmega1284RFR2 ATmega128RFA1 ATmega128RFR2 ATmega16 ATmega161 ATmega162 ATmega163 ATmega164P ATmega168 ATmega168P ATmega169 ATmega16U2 ATmega2560 ATmega2561 ATmega2564RFR2 ATmega256RFR2 ATmega32 ATmega324P ATmega324PA ATmega325 ATmega3250 ATmega328 ATmega328P ATmega329 ATmega3290 ATmega3290P ATmega329P ATmega32U2 ATmega32U4 ATMEGA406 ATmega48 ATmega48P ATmega64 ATmega640 ATmega644 ATmega644P ATmega644RFR2 ATmega645 ATmega6450 ATmega649 ATmega6490 ATmega64RFR2 ATmega8 ATmega8515 ATmega8535 ATmega88 ATmega88P ATmega8U2 ATtiny10 ATtiny11 ATtiny12 ATtiny13 ATtiny15 ATtiny1634 ATtiny20 ATtiny2313 ATtiny24 ATtiny25 ATtiny26 ATtiny261 ATtiny4 ATtiny40 ATtiny4313 ATtiny43u ATtiny44 ATtiny45 ATtiny461 ATtiny5 ATtiny84 ATtiny85 ATtiny861 ATtiny88 ATtiny9 ATxmega128A1 ATxmega128A1revD ATxmega128A1U ATxmega128A3 ATxmega128A3U ATxmega128A4 ATxmega128A4U ATxmega128B1 ATxmega128B3 ATxmega128C3 ATxmega128D3 ATxmega128D4 ATxmega16A4 ATxmega16A4U ATxmega16C4 ATxmega16D4 ATxmega16E5 ATxmega192A1 ATxmega192A3 ATxmega192A3U ATxmega192C3 ATxmega192D3 ATxmega256A1 ATxmega256A3 ATxmega256A3B ATxmega256A3BU ATxmega256A3U ATxmega256C3 ATxmega256D3 ATxmega32A4 ATxmega32A4U ATxmega32C4 ATxmega32D4 ATxmega32E5 ATxmega384C3 ATxmega384D3 ATxmega64A1 ATxmega64A1U ATxmega64A3 ATxmega64A3U ATxmega64A4 ATxmega64A4U ATxmega64B1 ATxmega64B3 ATxmega64C3 ATxmega64D3 ATxmega64D4 ATxmega8E5"
parts="ATmega128 ATmega1280 ATmega1281 ATmega1284P ATmega1284RFR2 ATmega128RFA1 ATmega128RFR2 ATmega16 ATmega161 ATmega162 ATmega163 ATmega164P ATmega168 ATmega168P ATmega169 ATmega16U2 ATmega2560 ATmega2561 ATmega2564RFR2 ATmega256RFR2 ATmega32 ATmega324P ATmega324PA ATmega325 ATmega3250 ATmega328 ATmega328P ATmega329 ATmega3290 ATmega3290P ATmega329P ATmega32U2 ATmega32U4 ATMEGA406 ATmega48 ATmega48P ATmega64 ATmega640 ATmega644 ATmega644P ATmega644RFR2 ATmega645 ATmega6450 ATmega649 ATmega6490 ATmega64RFR2 ATmega8 ATmega8515 ATmega8535 ATmega88 ATmega88P ATmega8U2"
parts="AT32UC3A0512 AT90CAN128 AT90CAN32 AT90CAN64 AT90PWM2 AT90PWM2B AT90PWM3 AT90PWM316 AT90PWM3B AT90S1200 AT90S2313 AT90S2333 AT90S2343 AT90S4414 AT90S4433 AT90S4434 AT90S8515 AT90S8535 AT90USB1286 AT90USB1287 AT90USB162 AT90USB646 AT90USB647 AT90USB82 ATmega128 ATmega1280 ATmega1281 ATmega1284P ATmega1284RFR2 ATmega128RFA1 ATmega128RFR2 ATmega16 ATmega161 ATmega162 ATmega163 ATmega164P ATmega168 ATmega168P ATmega169 ATmega16U2 ATmega2560 ATmega2561 ATmega2564RFR2 ATmega256RFR2 ATmega32 ATmega324P ATmega324PA ATmega325 ATmega3250 ATmega328 ATmega328P ATmega329 ATmega3290 ATmega3290P ATmega329P ATmega32U2 ATmega32U4 ATMEGA406 ATmega48 ATmega48P ATmega64 ATmega640 ATmega644 ATmega644P ATmega644RFR2 ATmega645 ATmega6450 ATmega649 ATmega6490 ATmega64RFR2 ATmega8 ATmega8515 ATmega8535 ATmega88 ATmega88P ATmega8U2 ATtiny10 ATtiny11 ATtiny12 ATtiny13 ATtiny15 ATtiny1634 ATtiny20 ATtiny2313 ATtiny24 ATtiny25 ATtiny26 ATtiny261 ATtiny4 ATtiny40 ATtiny4313 ATtiny43u ATtiny44 ATtiny45 ATtiny461 ATtiny5 ATtiny84 ATtiny85 ATtiny861 ATtiny88 ATtiny9 ATxmega128A1 ATxmega128A1revD ATxmega128A1U ATxmega128A3 ATxmega128A3U ATxmega128A4 ATxmega128A4U ATxmega128B1 ATxmega128B3 ATxmega128C3 ATxmega128D3 ATxmega128D4 ATxmega16A4 ATxmega16A4U ATxmega16C4 ATxmega16D4 ATxmega16E5 ATxmega192A1 ATxmega192A3 ATxmega192A3U ATxmega192C3 ATxmega192D3 ATxmega256A1 ATxmega256A3 ATxmega256A3B ATxmega256A3BU ATxmega256A3U ATxmega256C3 ATxmega256D3 ATxmega32A4 ATxmega32A4U ATxmega32C4 ATxmega32D4 ATxmega32E5 ATxmega384C3 ATxmega384D3 ATxmega64A1 ATxmega64A1U ATxmega64A3 ATxmega64A3U ATxmega64A4 ATxmega64A4U ATxmega64B1 ATxmega64B3 ATxmega64C3 ATxmega64D3 ATxmega64D4 ATxmega8E5"
parts="ATmega128 ATmega1280 ATmega1281 ATmega1284P ATmega1284RFR2 ATmega128RFA1 ATmega128RFR2 ATmega16 ATmega161 ATmega162 ATmega163 ATmega164P ATmega168 ATmega168P ATmega169 ATmega16U2 ATmega2560 ATmega2561 ATmega2564RFR2 ATmega256RFR2 ATmega32 ATmega324P ATmega324PA ATmega325 ATmega3250 ATmega328 ATmega328P ATmega329 ATmega3290 ATmega3290P ATmega329P ATmega32U2 ATmega32U4 ATMEGA406 ATmega48 ATmega48P ATmega64 ATmega640 ATmega644 ATmega644P ATmega644RFR2 ATmega645 ATmega6450 ATmega649 ATmega6490 ATmega64RFR2 ATmega8 ATmega8515 ATmega8535 ATmega88 ATmega88P ATmega8U2"

for port in /dev/ttyUSB? /dev/ttyACM? ; do
	for baud in 57600 115200; do
		for part in $parts; do
			echo "Trying Arduino $part on $port / $baud" >&2
			#echo /home/hsaturn/arduino/arduino-1.0.6/hardware/tools/avrdude -C/home/hsaturn/arduino/arduino-1.0.6/hardware/tools/avrdude.conf -v -patmega168 -carduino -P/dev/$port -b$baud -V 
			if ( /home/hsaturn/arduino/arduino-1.0.6/hardware/tools/avrdude -C/home/hsaturn/arduino/arduino-1.0.6/hardware/tools/avrdude.conf -v -p$part -carduino -P$port -b$baud -V  2>/dev/null ); then
				echo >&2
				echo "Found Arduino $part on $port / $baud"
				echo >&2
			fi &
			pid=$!
			count=0
			while( kill -0 $pid 2>/dev/null); do
				sleep 0.1
				((count++))
				if [ "$count" == 20 ]; then
					echo "Kill detection (too long)" >&2
					kill -kill $pid
				fi
			done
		done
	done
done
